(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{1592:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(3),l=n(205),u=n(29),o=n(15),s=n(2),c=Object(i.default)(l.default,{target:"e1xs0x250"})("position:relative;top:-1px;font-size:",function(e){return e.theme.fontSizeSmall},";font-weight:normal;padding:3px 6px;margin-left:",Object(o.default)(.5),";border-radius:20px;");t.a=function(){return r.a.createElement(u.default,{title:Object(s.t)("This feature is in beta and may change in the future."),tooltipOptions:{placement:"right"}},r.a.createElement(c,{priority:"beta",size:"small"},"beta"))}},1667:function(e,t,n){var a=n(90),r=n(119),i="Expected a function";e.exports=function(e,t,n){var l=!0,u=!0;if("function"!=typeof e)throw new TypeError(i);return r(n)&&(l="leading"in n?!!n.leading:l,u="trailing"in n?!!n.trailing:u),a(e,t,{leading:l,maxWait:t,trailing:u})}},2349:function(e,t,n){"use strict";n.r(t);var a=n(12),r=n.n(a),i=n(4),l=n.n(i),u=n(6),o=n.n(u),s=n(7),c=n.n(s),d=n(5),p=n.n(d),f=n(8),v=n.n(f),h=n(0),m=n.n(h),g=n(1),y=n.n(g),b=n(10),O=n(97),E=n.n(O),j=n(91),x=n(2),w=n(143),q=n(381),k=n(117),Q=n(81),R=n(9),S=n(26),C=n.n(S),z=n(46),D=n.n(z),F=n(39),L=n(1592),T=n(188),B=n(13),N=n.n(B),I=n(11),M=n.n(I),U=n(16),A=n(42),V=n(3),P=n(25),W=n(163),H=n(24),K=n(382),G=n(61),Y=n(146),J=n(15),X=n(69),Z=n(23),$=n(54),_=Object(V.default)(U.Flex,{target:"elv28ey0"})("flex:1;"),ee=Object(V.default)(U.Flex,{target:"elv28ey1"})("width:100%;height:100vh;position:relative;margin-bottom:-20px;.control-group{margin-bottom:0;/* Do not want the global control-group margins  */}"),te=Object(V.default)(K.a,{target:"elv28ey2"})("position:absolute;top:0;left:0;"),ne=(Object(J.default)(4),Object(V.default)("div",{target:"elv28ey4"})("display:flex;align-items:flex-start;justify-content:space-between;border-bottom:1px solid ",function(e){return e.theme.borderLight},";margin-bottom:",Object(J.default)(3),";@media (max-width:",X.default.breakpoints[1],"){justify-content:flex-start;}")),ae=Object(V.default)(Y.default,{target:"elv28ey5"})("margin-bottom:0;@media (max-width:",X.default.breakpoints[1],"){display:none;}"),re=Object(V.default)("div",{target:"elv28ey6"})("display:none;@media (max-width:",X.default.breakpoints[1],"){display:flex;margin-bottom:",Object(J.default)(2),";}"),ie=Object(V.default)(H.default,{target:"elv28ey7"})("@media (max-width:",X.default.breakpoints[1],"){margin-left:",Object(J.default)(.5),";top:0;}"),le=Object(V.default)(function(e){return m.a.createElement(U.Flex,M()({},e,{direction:"column",w:[300,300,300,360]}))},{target:"elv28ey8"})("border-right:1px solid ",function(e){return e.theme.borderDark},";background:#fff;min-width:320px;position:relative;padding-top:",60,"px;"),ue=Object(V.default)(U.Flex,{target:"elv28ey9"})("height:100%;flex-direction:column;justify-content:flex-start;"),oe=Object(V.default)("div",{target:"elv28ey10"})("flex-grow:1;margin:",Object(J.default)(3)," ",Object(J.default)(3)," 0;border-bottom:1px solid ",function(e){return e.theme.borderLight},";"),se=Object(V.default)($.a,{target:"elv28ey11"})("color:",function(e){return e.theme.gray4},";&:hover{color:",function(e){return e.theme.blue},";}"),ce=Object(V.default)(Z.default,{target:"elv28ey12"})("justify-content:flex-end;"),de=Object(V.default)("span",{target:"elv28ey13"})("align-items:center;display:flex;margin:25px ",Object(J.default)(3),";justify-content:space-between;"),pe=Object(V.default)("span",{target:"elv28ey14"})("font-size:15px;flex-grow:1;"),fe=Object(V.default)(Z.default,{target:"elv28ey15"})("width:20px;height:20px;margin-right:8px;"),ve=Object(V.default)(U.Flex,{target:"elv28ey16"})("flex:1;flex-direction:column;overflow:hidden;padding-top:",60,"px;"),he=Object(V.default)(U.Flex,{target:"elv28ey17"})("flex:1;flex-direction:column;padding:",Object(J.default)(3)," ",Object(J.default)(4)," ",Object(J.default)(4)," ",Object(J.default)(4),";overflow-y:scroll;position:relative;background:",function(e){return e.theme.whiteDark},";"),me=Object(V.default)(U.Flex,{target:"elv28ey18"})("flex:1;align-items:center;height:100%;"),ge=Object(V.default)(function(e){return m.a.createElement(Y.default,M()({},e,{underlined:!0}))},{target:"elv28ey19"})("padding:",Object(J.default)(3)," ",Object(J.default)(3)," 0;margin:0;"),ye=Object(V.default)("div",{target:"elv28ey20"})("color:",function(e){return e.theme.gray6},";font-size:15px;"),be=Object(V.default)(U.Flex,{target:"elv28ey21"})("min-width:70px;margin:",Object(J.default)(1)," 0 ",Object(J.default)(2),";align-items:center;"),Oe=Object(V.default)("fieldset",{target:"elv28ey22"})("margin:",Object(J.default)(2)," ",Object(J.default)(3),";"),Ee=Object(V.default)(U.Flex,{target:"elv28ey23"})("margin-top:",Object(J.default)(.5),";"),je=Object(V.default)("label",{target:"elv28ey24"})("text-transform:uppercase;font-size:",function(e){return e.theme.fontSizeSmall},";color:",function(e){return e.theme.gray3},";"),xe=Object(V.default)("div",{target:"elv28ey25"})("flex:1;overflow-y:scroll;"),we=Object(V.default)("span",{target:"elv28ey26"})("font-style:italic;text-decoration:underline;margin-left:4px;font-size:13px;line-height:16px;color:",function(e){return e.theme.gray1},";"),qe=Object(A.keyframes)("0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}"),ke=Object(V.default)("div",{target:"elv28ey27"})("animation:",qe," 0.4s linear infinite;width:14px;height:14px;border-radius:14px;border-top:2px solid ",function(e){return e.theme.borderLight},";border-right:2px solid ",function(e){return e.theme.borderLight},";border-bottom:2px solid ",function(e){return e.theme.borderLight},";border-left:2px solid ",function(e){return e.theme.purple},";margin-left:4px;"),Qe=Object(V.default)(U.Box,{target:"elv28ey28"})("color:",function(e){return e.theme.gray6},";font-size:",function(e){return e.theme.fontSizeSmall},";"),Re=Object(V.default)(U.Flex,{target:"elv28ey29"})("justify-content:space-between;"),Se=Object(V.default)("div",{target:"elv28ey30"})("display:flex;flex:1;flex-direction:column;margin-bottom:",Object(J.default)(3),";"),Ce=Object(V.default)("div",{target:"elv28ey31"})("flex:1;"),ze=Object(V.default)(P.a,{target:"elv28ey32"})("padding:",Object(J.default)(3)," ",Object(J.default)(2),";"),De=Object(V.default)(U.Box,{target:"elv28ey33"})("text-align:center;font-size:",function(e){return e.theme.fontSizeMedium},";color:",function(e){return e.theme.gray3},";margin-bottom:",Object(J.default)(3),";"),Fe=Object(V.default)(G.a,{target:"elv28ey34"})("color:",function(e){return e.theme.gray6},";margin-left:",Object(J.default)(2),";display:flex;"),Le=Object(V.default)("div",{target:"elv28ey35"})("flex:1;overflow-y:scroll;"),Te=Object(V.default)(P.a,{target:"elv28ey36"})("margin:0;border:0;overflow:hidden;"),Be=Object(V.default)(function(e){e.isActive;var t=N()(e,["isActive"]);return m.a.createElement(P.f,t)},{target:"elv28ey37"})("flex-direction:column;padding:0;background-color:",function(e){return e.isActive?e.theme.whiteDark:e.theme.white},";"),Ne=Object(V.default)(G.a,{target:"elv28ey38"})("font-weight:600;padding:",Object(J.default)(2)," ",Object(J.default)(4),";"),Ie=Object(V.default)("div",{target:"elv28ey39"})("font-size:",function(e){return e.theme.fontSizeSmall},";color:",function(e){return e.theme.gray6},";"),Me=Object(V.default)("div",{target:"elv28ey40"})("position:absolute;width:calc(100% + 1px);/* Add 1px for border */\n  height:calc(100% - ",60,"px);background-color:white;top:",60,"px;border-right:1px solid ",function(e){return e.theme.borderLight},";animation:",W.i," 0.2s ease-in;overflow-y:scroll;"),Ue=Object(V.default)(U.Flex,{target:"elv28ey41"})("justify-content:space-between;align-items:center;padding:0 ",Object(J.default)(4),";height:",60,"px;border-bottom:1px solid ",function(e){return e.theme.borderLight},";"),Ae=Object(V.default)(G.a,{target:"elv28ey42"})("color:",function(e){return e.theme.gray6},";"),Ve=n(1583),Pe=n(1621),We=n(276),He=n.n(We),Ke=n(1570),Ge=new Set(["IS NULL","IS NOT NULL"]);function Ye(e,t){var n=new Set(Ke.c),a=new Set(t.map(function(e){return e.name})).has(e[0]),r=n.has(e[1]),i=(t.find(function(t){return t.name===e[0]})||{}).type,l=Ge.has(e[1])||"datetime"===i&&null!==e[2]||i===He()(e[2]);return a&&r&&l}function Je(e){return e.join(" ").trim()}function Xe(e,t){var n=[null,null,null],a=(e=e||"").split(" ")[0];new Set(t.map(function(e){return e.name})).has(a)&&(n[0]=a);var r=(null!==n[0]?e.replace(n[0],""):e).trim();if(Ge.has(r)?n[1]=r:Ke.c.forEach(function(e){r.startsWith(e)&&(n[1]=e)}),n[0]&&n[1]&&!Ge.has(n[1])){var i="".concat(n[0]," ").concat(n[1]," ");e.startsWith(i)&&(n[2]=e.replace(i,""));var l=t.find(function(e){return e.name===a}).type;if("number"===l){var u=parseInt(n[2],10);n[2]=isNaN(u)?null:u}if("boolean"===l&&("true"===n[2]&&(n[2]=!0),"false"===n[2]&&(n[2]=!1)),"datetime"===l){var o=D.a.utc(n[2]);n[2]=o.isValid()?o.format("YYYY-MM-DDTHH:mm:ss"):null}}return n}function Ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(" ")[0],n=e.match(/^[\w._]+\s(.*)/),a=n?n[1]:null;if(!a)return e;for(var r=0;r<Ke.c.length;r++){var i=Ke.c[r];if(i.startsWith(a.toUpperCase()))return"".concat(t," ").concat(a.toUpperCase());if(a.toUpperCase().startsWith(i))return"".concat(t," ").concat(i," ").concat(a.slice(i.length+1))}return e}var $e=n(36);var _e=n(44),et=n.n(_e),tt=n(308),nt=n(422),at=n(102),rt=n(484),it=n(165),lt=n(50),ut=n.n(lt),ot=n(330),st=function(e){function t(e){var n;return l()(this,t),(n=c()(this,p()(t).call(this,e))).filterOptions=function(){var e=n.state.inputValue,t=[{value:"count",label:"count"},{value:"uniq",label:"uniq(...)"},{value:"avg",label:"avg(...)"}];return e.startsWith("uniq")&&(t=n.props.columns.filter(function(e){var t=e.name;return!Ke.a.some(function(e){return t.startsWith(e)})}).map(function(e){var t=e.name;return{value:"uniq(".concat(t,")"),label:"uniq(".concat(t,")")}})),e.startsWith("avg")&&(t=n.props.columns.filter(function(e){return"number"===e.type}).map(function(e){var t=e.name;return{value:"avg(".concat(t,")"),label:"avg(".concat(t,")")}})),t.filter(function(t){return t.label.includes(e)})},n.handleChange=function(e){"uniq"===e.value||"avg"===e.value?n.setState({inputValue:e.value},n.focus):(n.setState({inputValue:e.value,isOpen:!1}),n.props.onChange(Object(Pe.a)(e.value)))},n.handleOpen=function(){""===n.state.inputValue&&n.setState({inputValue:Object(Pe.b)(n.props.value),isOpen:!0})},n.inputRenderer=function(e){return m.a.createElement("input",M()({type:"text"},e,{onChange:function(t){""===t.target.value?n.setState({inputValue:t.target.value},e.onChange(t)):e.onChange(t)},value:n.state.inputValue,style:{width:"100%",border:0,backgroundColor:"transparent"}}))},n.valueComponent=function(e){return n.state.isOpen?null:m.a.createElement(ot.d,e)},n.handleInputChange=function(e){n.setState({inputValue:e})},n.state={inputValue:"",isOpen:!1},n}return v()(t,e),o()(t,[{key:"getOptions",value:function(){var e=Object(Pe.b)(this.props.value);return e||this.state.inputValue?[{label:e,value:e}]:[]}},{key:"focus",value:function(){this.select.focus()}},{key:"render",value:function(){var e=this;return m.a.createElement(U.Box,{w:1},m.a.createElement(at.a,{innerRef:function(t){return e.select=t},value:Object(Pe.b)(this.props.value),placeholder:m.a.createElement(ye,null,Object(x.t)("Add aggregation function...")),options:this.getOptions(),filterOptions:this.filterOptions,onChange:this.handleChange,onOpen:this.handleOpen,closeOnSelect:!0,openOnFocus:!0,autoBlur:!0,clearable:!1,backspaceRemoves:!1,deleteRemoves:!1,inputRenderer:this.inputRenderer,valueComponent:this.valueComponent,onInputChange:this.handleInputChange,disabled:this.props.disabled}))}}]),t}(m.a.Component);st.propTypes={value:y.a.array.isRequired,onChange:y.a.func.isRequired,columns:y.a.array.isRequired,disabled:y.a.bool};var ct=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"addRow",value:function(){this.props.onChange([].concat(ut()(this.props.value),[[null,null,null]]))}},{key:"removeRow",value:function(e){var t=this.props.value.slice();t.splice(e,1),this.props.onChange(t)}},{key:"handleChange",value:function(e,t){var n=this.props.value.slice();n[t]=e,this.props.onChange(n)}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,a=t.columns,r=t.disabled;return m.a.createElement("div",null,m.a.createElement("div",null,m.a.createElement(je,null,Object(x.t)("Aggregation")),!r&&m.a.createElement(we,null,"(",m.a.createElement(G.a,{onClick:function(){return e.addRow()}},Object(x.t)("Add")),")")),!n.length&&m.a.createElement(ye,null,Object(x.t)("None, showing raw event data")),n.map(function(t,n){return m.a.createElement(Ee,{key:"".concat(n,"_").concat(t[2])},m.a.createElement(st,{value:t,onChange:function(t){return e.handleChange(t,n)},columns:a,disabled:r}),m.a.createElement(U.Box,{ml:1},m.a.createElement("a",{onClick:function(){return e.removeRow(n)}},m.a.createElement(Z.default,{src:"icon-circle-close",height:"38px"}))))}))}}]),t}(m.a.Component);ct.propTypes={value:y.a.array.isRequired,onChange:y.a.func.isRequired,columns:y.a.array,disabled:y.a.bool};var dt=n(38),pt=n.n(dt),ft=function(e){function t(e){var n;return l()(this,t),(n=c()(this,p()(t).call(this,e))).handleChange=function(e){var t=Xe(e.value,n.props.columns);Ye(t,n.props.columns)?n.setState({inputValue:"",isOpen:!1},n.props.onChange(t)):n.setState({inputValue:e.value},n.focus)},n.handleOpen=function(){""===n.state.inputValue&&n.setState({inputValue:Je(n.props.value),isOpen:!0})},n.filterOptions=function(e){var t=n.state.inputValue,a=e,r=Xe(t,n.props.columns);if(Ye(r,n.props.columns))return[];var i=null!==r[0],l=null!==r[1];if(i||(a=n.props.columns.map(function(e){var t=e.name;return{value:"".concat(t),label:"".concat(t,"...")}})),i&&!l){var u=r[0];a=n.getConditionsForColumn(u).map(function(e){var t="".concat(u," ").concat(e);return{value:t,label:t}})}return a.filter(function(e){return e.label.includes(t)})},n.isValidNewOption=function(e){var t=e.label;return Ye(Xe(t=Ze(t),n.props.columns),n.props.columns)},n.inputRenderer=function(e){return m.a.createElement("input",M()({type:"text"},e,{onChange:function(t){""===t.target.value?n.setState({inputValue:t.target.value},e.onChange(t)):e.onChange(t)},value:n.state.inputValue,style:{width:"100%",border:0,zIndex:1e3,backgroundColor:"transparent"}}))},n.valueComponent=function(e){return n.state.inputValue?null:m.a.createElement(ot.d,e)},n.shouldKeyDownEventCreateNewOption=function(e){return new Set([13,9]).has(e)},n.handleInputChange=function(e){return n.setState({inputValue:Ze(e)}),e},n.handleBlur=function(e){var t=Xe(e.target.value,n.props.columns);Ye(t,n.props.columns)&&n.setState({inputValue:""},n.props.onChange(t))},n.newOptionCreator=function(e){var t,n=e.label,a=e.labelKey,r=e.valueKey;return n=Ze(n),t={},pt()(t,r,n),pt()(t,a,n),t},n.state={inputValue:"",isOpen:!1},n}return v()(t,e),o()(t,[{key:"focus",value:function(){this.select.focus()}},{key:"getOptions",value:function(){var e=Je(this.props.value);return e||this.state.inputValue?[{label:e,value:e}]:[]}},{key:"getConditionsForColumn",value:function(e){var t=this.props.columns.find(function(t){return t.name===e}),n=t?t.type:"string",a=new Set([">","<",">=","<="]),r=new Set(["LIKE","NOT LIKE"]);return Ke.c.filter(function(t){return"number"===n||"datetime"===n?!r.has(t):Ke.a.some(function(t){return e.startsWith(t)})?["=","!=","LIKE","NOT LIKE"].includes(t):!a.has(t)})}},{key:"render",value:function(){var e=this;return m.a.createElement(U.Box,{w:1},m.a.createElement(at.a,{innerRef:function(t){return e.select=t},value:Je(this.props.value),placeholder:m.a.createElement(ye,null,Object(x.t)("Add condition...")),options:this.getOptions(),filterOptions:this.filterOptions,onChange:this.handleChange,onOpen:this.handleOpen,closeOnSelect:!0,openOnFocus:!0,autoBlur:!0,clearable:!1,backspaceRemoves:!1,deleteRemoves:!1,isValidNewOption:this.isValidNewOption,inputRenderer:this.inputRenderer,valueComponent:this.valueComponent,onInputChange:this.handleInputChange,onBlur:this.handleBlur,creatable:!0,promptTextCreator:function(e){return e},shouldKeyDownEventCreateNewOption:this.shouldKeyDownEventCreateNewOption,disabled:this.props.disabled,newOptionCreator:this.newOptionCreator}))}}]),t}(m.a.Component);ft.propTypes={value:y.a.array.isRequired,onChange:y.a.func.isRequired,columns:y.a.arrayOf(y.a.shape({name:y.a.string,type:y.a.string})).isRequired,disabled:y.a.bool};var vt=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"addRow",value:function(){this.props.onChange([].concat(ut()(this.props.value),[[null,null,null]]))}},{key:"removeRow",value:function(e){var t=this.props.value.slice();t.splice(e,1),this.props.onChange(t)}},{key:"handleChange",value:function(e,t){var n=this.props.value.slice();n[t]=e,this.props.onChange(n)}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,a=t.columns,r=t.disabled;return m.a.createElement("div",null,m.a.createElement("div",null,m.a.createElement(je,null,Object(x.t)("Conditions")),!r&&m.a.createElement(we,null,"(",m.a.createElement(G.a,{onClick:function(){return e.addRow()}},Object(x.t)("Add")),")")),!n.length&&m.a.createElement(ye,null,Object(x.t)("None, showing all events")),n.map(function(t,n){return m.a.createElement(Ee,{key:"".concat(n,"_").concat(t[2])},m.a.createElement(ft,{value:t,onChange:function(t){return e.handleChange(t,n)},columns:a,disabled:r}),m.a.createElement(U.Box,{ml:1},m.a.createElement("a",{onClick:function(){return e.removeRow(n)}},m.a.createElement(Z.default,{src:"icon-circle-close",height:"38px"}))))}))}}]),t}(m.a.Component);vt.propTypes={value:y.a.arrayOf(y.a.array).isRequired,onChange:y.a.func.isRequired,columns:y.a.array.isRequired,disabled:y.a.bool};var ht=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"updateField",value:function(e){var t=this.getInternal(this.props.value);t.field=e,this.props.onChange(this.getExternal(t))}},{key:"updateDirection",value:function(e){var t=this.getInternal(this.props.value);t.direction=e,this.props.onChange(this.getExternal(t))}},{key:"getExternal",value:function(e){return"".concat("desc"===e.direction?"-":"").concat(e.field)}},{key:"getInternal",value:function(e){return{direction:e.startsWith("-")?"desc":"asc",field:e.replace(/^-/,"")}}},{key:"render",value:function(){var e=this,t=this.props,n=t.disabled,a=t.columns,r=t.value,i=this.getInternal(r),l=i.direction,u=i.field;return m.a.createElement(m.a.Fragment,null,m.a.createElement(je,{className:"control-label"},Object(x.t)("Order by")),m.a.createElement(U.Flex,null,m.a.createElement(mt,null,m.a.createElement(at.a,{name:"orderbyField",options:a,value:u,onChange:function(t){return e.updateField(t.value)},disabled:n})),m.a.createElement(gt,null,m.a.createElement(at.a,{name:"orderbyDirection",options:[{value:"asc",label:"asc"},{value:"desc",label:"desc"}],value:l,onChange:function(t){return e.updateDirection(t.value)},disabled:n}))))}}]),t}(m.a.Component);ht.propTypes={value:y.a.string.isRequired,columns:y.a.array.isRequired,onChange:y.a.func.isRequired,disabled:y.a.bool};var mt=Object(V.default)("div",{target:"epz00bc0"})("width:calc(100% / 3 * 2);padding-right:",Object(J.default)(1),";"),gt=Object(V.default)("div",{target:"epz00bc1"})("width:calc(100% / 3);"),yt=function(e){function t(){var e,n;l()(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=c()(this,(e=p()(t)).call.apply(e,[this].concat(r)))).getSummarizePlaceholder=function(){var e=n.props.queryBuilder.getInternal().aggregations.length>0?Object(x.t)("Select fields"):Object(x.t)("No fields selected, showing all");return m.a.createElement(ye,null,e)},n.optionRenderer=function(e){var t=e.label,n=e.isTag;return m.a.createElement(U.Flex,{align:"center"},t,n&&m.a.createElement(rt.default,{text:"tag"}))},n}return v()(t,e),o()(t,[{key:"render",value:function(){var e=this.props,t=e.queryBuilder,n=e.onUpdateField,a=e.actions,r=e.isLoading,i=e.savedQuery,l=e.savedQueryName,u=e.onUpdateName,o=t.getInternal(),s=t.getColumns(),c=s.filter(function(e){var t=e.name;return!Ke.f.includes(t)}),d=s.map(function(e){var t=e.name;return{value:t,label:t,isTag:e.isTag}});return m.a.createElement(ue,null,i&&m.a.createElement(Oe,null,m.a.createElement(m.a.Fragment,null,m.a.createElement(je,{htmlFor:"name",className:"control-label"},Object(x.t)("Name")),m.a.createElement(tt.a,{name:"name",value:Object(it.a)({value:l,fixed:"query name"}),placeholder:Object(x.t)("Saved search name"),onChange:function(e){return u(e)}}))),m.a.createElement(Oe,null,m.a.createElement(je,{htmlFor:"fields",className:"control-label"},Object(x.t)("Summarize")),m.a.createElement(at.a,{name:"fields",multiple:!0,placeholder:this.getSummarizePlaceholder(),options:d,optionRenderer:this.optionRenderer,value:o.fields,onChange:function(e){return n("fields",e.map(function(e){return e.value}))},clearable:!0,disabled:r})),m.a.createElement(Oe,null,m.a.createElement(ct,{value:o.aggregations,columns:s,onChange:function(e){return n("aggregations",e)},disabled:r})),m.a.createElement(Oe,null,m.a.createElement(vt,{value:o.conditions,columns:c,onChange:function(e){return n("conditions",e)},disabled:r})),m.a.createElement(Oe,null,m.a.createElement(ht,{value:o.orderby,columns:Object(Ve.f)(t),onChange:function(e){return n("orderby",e)},disabled:r})),m.a.createElement(Oe,null,m.a.createElement(nt.a,{name:"limit",label:m.a.createElement(je,null,Object(x.t)("Limit")),placeholder:"#",value:o.limit,onChange:function(e){return n("limit","number"==typeof e?e:null)},disabled:r})),m.a.createElement(Oe,null,a),m.a.createElement(oe,null),m.a.createElement(se,{href:"https://docs.sentry.io/product/discover/"},m.a.createElement(de,null,m.a.createElement(fe,{src:"icon-docs"}),m.a.createElement(pe,null,Object(x.t)("Discover Documentation")),m.a.createElement(ce,{src:"icon-chevron-right",size:"1em"}))))}}]),t}(m.a.Component);yt.propTypes={queryBuilder:y.a.object.isRequired,onUpdateField:y.a.func.isRequired,actions:y.a.node.isRequired,isLoading:y.a.bool.isRequired,savedQuery:R.default.DiscoverSavedQuery,savedQueryName:y.a.string,onUpdateName:y.a.func};var bt=function(e){function t(e){var n;return l()(this,t),(n=c()(this,p()(t).call(this,e))).state={savedQueryName:e.savedQuery.name},n}return v()(t,e),o()(t,[{key:"handleUpdateName",value:function(e){this.setState({savedQueryName:e})}},{key:"hasChanges",value:function(){var e=this.props,t=e.queryBuilder,n=e.savedQuery;return!et()(Object(Ve.j)(n),t.getInternal())||this.state.savedQueryName!==n.name}},{key:"render",value:function(){var e=this,t=this.props,n=t.queryBuilder,a=t.savedQuery,r=t.isFetchingQuery,i=t.onUpdateField,l=t.onRunQuery,u=t.onDeleteQuery,o=t.onSaveQuery,s=t.isLoading,c=this.state.savedQueryName;return m.a.createElement(yt,{queryBuilder:n,onUpdateField:i,isLoading:s,savedQuery:a,savedQueryName:this.state.savedQueryName,onUpdateName:function(t){return e.handleUpdateName(t)},actions:m.a.createElement(U.Flex,{justify:"space-between"},m.a.createElement(U.Flex,null,m.a.createElement(U.Box,{mr:1},m.a.createElement(H.default,{size:"xsmall",onClick:l,priority:"primary",busy:r},Object(x.t)("Run"),r&&m.a.createElement(ke,null))),m.a.createElement(U.Box,null,m.a.createElement(H.default,{size:"xsmall",onClick:function(){return o(c)},disabled:!this.hasChanges()},Object(x.t)("Save")))),m.a.createElement(U.Box,null,m.a.createElement(Fe,{"data-test-id":"delete",onClick:u},m.a.createElement(Z.default,{src:"icon-trash"}))))})}}]),t}(m.a.Component);bt.propTypes={queryBuilder:y.a.object.isRequired,onRunQuery:y.a.func.isRequired,savedQuery:R.default.DiscoverSavedQuery,onUpdateField:y.a.func.isRequired,onDeleteQuery:y.a.func.isRequired,onSaveQuery:y.a.func.isRequired,isFetchingQuery:y.a.bool.isRequired,isLoading:y.a.bool.isRequired};var Ot=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"getExampleQueries",value:function(){return[{title:Object(x.t)("Events by stack filename"),description:"What is my most problematic code?",query:{fields:["stack.filename"],aggregations:[["count()",null,"count"]],conditions:[],orderby:"-count"}},{title:Object(x.t)("Unique issues by user"),description:Object(x.t)("Who's having the worst time?"),query:{fields:["user.id","user.username","user.email","user.ip"],aggregations:[["uniq","issue.id","uniq_issue_id"]],conditions:[],orderby:"-uniq_issue_id"}},{title:Object(x.t)("Events by geography"),description:"Are my services less reliable in some regions?",query:{fields:["geo.country_code","geo.region","geo.city"],aggregations:[["count()",null,"count"]],conditions:[],orderby:"-count"}}]}},{key:"render",value:function(){var e=this;return m.a.createElement(Et,null,m.a.createElement(U.Box,{w:560},m.a.createElement(jt,null,Object(x.t)("Discover lets you query raw event data in Sentry")),m.a.createElement(xt,null,Object(x.tct)("Getting started? Try running one of the example queries below.\n            To learn more about how to use the query builder, [docs:see the docs].",{docs:m.a.createElement($.a,{href:"https://docs.sentry.io/product/discover/"})})),m.a.createElement(xt,null,this.getExampleQueries().map(function(t,n){var a=t.title,r=t.description,i=t.query;return m.a.createElement(wt,{key:n},m.a.createElement("div",null,m.a.createElement("div",null,a),m.a.createElement(qt,null,r)),m.a.createElement("div",null,m.a.createElement(H.default,{size:"small",onClick:function(){return e.props.updateQuery(i)}},Object(x.t)("Run"))))}))))}}]),t}(m.a.Component);Ot.propTypes={updateQuery:y.a.func.isRequired};var Et=Object(V.default)("div",{target:"euy2t1w0"})("display:flex;align-items:center;justify-content:center;font-size:",function(e){return e.theme.fontSizeLarge},";color:",function(e){return e.theme.gray5},";width:100%;height:100%;min-height:420px;min-width:500px;"),jt=Object(V.default)("div",{target:"euy2t1w1"})("font-size:",function(e){return e.theme.fontSizeExtraLarge},";font-weight:700;margin:0 0 20px;"),xt=Object(V.default)("div",{target:"euy2t1w2"})("margin:0 0 20px;"),wt=Object(V.default)(P.a,{target:"euy2t1w3"})("display:flex;justify-content:space-between;align-items:center;padding:",Object(J.default)(2),";"),qt=Object(V.default)("div",{target:"euy2t1w4"})("font-size:",function(e){return e.theme.fontSizeSmall},";color:",function(e){return e.theme.gray1},";"),kt=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"saveQuery",value:function(){var e=this.props,t=e.organization,n=e.queryBuilder,a=Object(Ve.e)(),i=r()({},n.getInternal(),{name:a});Object(Ve.a)(t,i).then(function(e){Object(F.addSuccessMessage)(Object(x.tct)("Successfully saved query [name]",{name:a})),b.browserHistory.push({pathname:"/organizations/".concat(t.slug,"/discover/saved/").concat(e.id,"/"),query:{editing:!0}})}).catch(function(e){var t=e&&e.detail||Object(x.t)("Could not save query");Object(F.addErrorMessage)(t)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.queryBuilder,a=t.onRunQuery,r=t.onReset,i=t.isFetchingQuery,l=t.onUpdateField,u=t.isLoading;return m.a.createElement(xe,null,m.a.createElement(yt,{queryBuilder:n,onUpdateField:l,isLoading:u,actions:m.a.createElement(U.Flex,{justify:"space-between"},m.a.createElement(U.Flex,null,m.a.createElement(U.Box,{mr:1},m.a.createElement(H.default,{size:"xsmall",onClick:a,priority:"primary",busy:i},Object(x.t)("Run"),i&&m.a.createElement(ke,null))),m.a.createElement(U.Box,null,m.a.createElement(H.default,{size:"xsmall",onClick:function(){return e.saveQuery()}},Object(x.t)("Save")))),m.a.createElement(U.Box,null,m.a.createElement(H.default,{size:"xsmall",onClick:r},Object(x.t)("Reset"))))}))}}]),t}(m.a.Component);kt.propTypes={organization:R.default.Organization,queryBuilder:y.a.object.isRequired,onRunQuery:y.a.func.isRequired,onReset:y.a.func.isRequired,onUpdateField:y.a.func.isRequired,isFetchingQuery:y.a.bool.isRequired,isLoading:y.a.bool.isRequired};var Qt=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"render",value:function(){var e=this.props,t=e.title,n=e.onClose;return m.a.createElement(Me,null,m.a.createElement(Ue,null,m.a.createElement(T.a,null,t),m.a.createElement(Ae,{onClick:n},m.a.createElement(Z.default,{src:"icon-close",height:"38px"}))),this.props.children)}}]),t}(m.a.Component);Qt.propTypes={title:y.a.node.isRequired,onClose:y.a.func.isRequired};var Rt=n(1667),St=n.n(Rt),Ct=n(1870),zt=n(1695),Dt=n(1707),Ft=n(577),Lt=n(29),Tt=n(274),Bt=n(145),Nt=n(56),It=30,Mt=1,Ut=It+Mt,At=100,Vt=500,Pt=22,Wt=6,Ht=30,Kt=70,Gt=function(e){function t(){var e,n;l()(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=c()(this,(e=p()(t)).call.apply(e,[this].concat(r)))).getCellRenderer=function(e){return function(t){var a=t.key,r=t.rowIndex,i=t.columnIndex,l=t.style,u=n.props.data,o=u.data,s=u.meta,c=i===e.length,d=c?null:e[i].name,p=!c&&["number","integer"].includes(s[i].type)&&"issue.id"!=d?"right":"left";if(0===r)return m.a.createElement(Zt,{key:a,style:l,align:p},m.a.createElement("strong",null,d));var f=c?null:Object(Dt.f)(o[r-1][d]);return i<e.length&&"id"===e[i].name&&(f=n.getEventLink(o[r-1])),i<e.length&&"issue.id"===e[i].name&&(f=n.getIssueLink(o[r-1])),m.a.createElement(Xt,{key:a,style:l,isOddRow:r%2==1,align:p},f)}},n.hasSentry10=function(){return new Set(n.props.organization.features).has("sentry10")},n.getEventLink=function(e){var t=n.props.organization,a=t.slug,r=t.projects.find(function(t){return t.id==="".concat(e["project.id"])}).slug,i=n.hasSentry10()?"/organizations/".concat(a,"/projects/").concat(r,"/"):"/".concat(a,"/").concat(r,"/");return m.a.createElement(Lt.default,{title:Object(x.t)("Open event")},m.a.createElement(G.a,{href:"".concat(i,"events/").concat(e.id,"/"),target:"_blank"},e.id))},n.getIssueLink=function(e){var t=n.props.organization,a=t.slug,r=t.projects.find(function(t){return t.id==="".concat(e["project.id"])}).slug,i=n.hasSentry10()?"/organizations/".concat(a,"/"):"/".concat(a,"/").concat(r,"/");return m.a.createElement(Lt.default,{title:Object(x.t)("Open issue")},m.a.createElement(G.a,{to:"".concat(i,"issues/").concat(e["issue.id"]),target:"_blank"},e["issue.id"]))},n.getColumnWidths=function(e){var t=n.props.data.data,a=n.getColumnList(),r=[];a.length<20?a.forEach(function(e){var a=e.name,i=[n.measureText(a,!0)];ut()(new Set(t.map(function(e){return e[a]}))).map(function(e){return Object(Dt.e)(e)}).sort(function(e,t){return t.length-e.length}).slice(0,3).forEach(function(e){i.push(n.measureText(e,!1))});var l=Math.max(Math.min(Math.max.apply(Math,i)+Pt,Vt),At);r.push(l)}):a.forEach(function(){r.push(At)});var i=r.reduce(function(e,t){return e+t},0)+2;return r.push(Math.max(e-i,0)),r},n.getRowHeight=function(e,t){var a=n.props.data.data;if(0===e)return Ut;var r=a[e-1],i=t.map(function(e){return n.measureText(Object(Dt.e)(r[e]),!1)}),l=Math.max.apply(Math,ut()(i).concat([0])),u=Math.max(Math.min(Math.ceil(l/(Vt-Pt)),3),1);return It*u+Mt},n.getColumnList=function(){var e=n.props,t=e.query,a=e.data.meta,r=new Set([].concat(ut()(t.fields||[]),ut()(t.aggregations.map(function(e){return e[2]}))));return a.filter(function(e){var t=e.name;return r.has(t)})},n.measureText=function(e,t){n.canvas||(n.canvas=document.createElement("canvas"));var a=n.canvas.getContext("2d");return a.font=t?"bold 14px Rubik":"normal 14px Rubik",Math.ceil(a.measureText(e).width)+5},n.getMaxVisibleRows=function(e){if(!e)return Wt;var t=e-Ut-Kt,n=Math.floor(t/Ut);return Math.max(Math.min(n,Ht),Wt)},n}return v()(t,e),o()(t,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.data.meta!==e.data.meta&&this.grid.recomputeGridSize(),this.props.width!==e.width&&this.forceUpdate(function(){return t.grid.recomputeGridSize()})}},{key:"renderTable",value:function(){var e=this,t=this.props,n=t.data.data,a=t.height,r=this.getColumnList(),i=r.length+1,l=this.getMaxVisibleRows(a),u=this.getCellRenderer(r);return m.a.createElement(Tt.default,null,m.a.createElement(Jt,{visibleRows:Math.min(n.length,l)+1},m.a.createElement(Ft.a,null,function(t){var a=e.getColumnWidths(t.width),l=a.reduce(function(e,t,n){return t===Vt&&e.push(r[n].name),e},[]);return m.a.createElement(Ft.c,{ref:function(t){return e.grid=t},width:t.width-1,height:t.height,rowCount:n.length+1,columnCount:i,fixedRowCount:1,rowHeight:function(t){var n=t.index;return e.getRowHeight(n,l)},columnWidth:function(e){var t=e.index;return a[t]},cellRenderer:u,overscanByPixels:800})})),!n.length&&m.a.createElement(Bt.a,{small:!0},Object(x.t)("No results")))}},{key:"render",value:function(){var e=this.props.data.error;return e?m.a.createElement("div",null,e):m.a.createElement("div",null,this.renderTable())}}]),t}(m.a.Component);Gt.propTypes={organization:R.default.Organization.isRequired,data:y.a.object.isRequired,query:y.a.object.isRequired,height:y.a.number,width:y.a.number};var Yt=Object(Nt.a)(Gt),Jt=Object(V.default)(function(e){e.visibleRows;var t=N()(e,["visibleRows"]);return m.a.createElement("div",t)},{target:"e1iakkxc0"})("height:",function(e){return e.visibleRows*Ut+2},"px;/* cell height + cell border + top and bottom Panel border */\n  overflow:hidden;.ReactVirtualized__Grid{outline:none;}"),Xt=Object(V.default)("div",{target:"e1iakkxc1"})(function(e){return!e.isOddRow&&"background-color: ".concat(e.theme.whiteDark,";")}," ",function(e){return"text-align: ".concat(e.align,";")}," overflow:scroll;font-size:14px;line-height:",It,"px;padding:0 10px;border-top:1px solid ",function(e){return e.theme.borderLight},";::-webkit-scrollbar{display:none;}@-moz-document url-prefix(){overflow:hidden;}-ms-overflow-style:-ms-autohiding-scrollbar;"),Zt=Object(V.default)(Xt,{target:"e1iakkxc2"})("background:",function(e){return e.theme.offWhite},";color:",function(e){return e.theme.gray3},";border-top:none;border-bottom:1px solid ",function(e){return e.theme.borderDark},";&:first-of-type{border-top-left-radius:3px;}"),$t=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"render",value:function(){var e=this.props,t=e.getPreviousPage,n=e.getNextPage,a=e.previous,r=e.next;return m.a.createElement(_t,{className:"btn-group"},m.a.createElement(H.default,{className:"btn",disabled:!a,size:"xsmall",icon:"icon-chevron-left",onClick:t}),m.a.createElement(H.default,{className:"btn",disabled:!r,size:"xsmall",icon:"icon-chevron-right",onClick:n}))}}]),t}(m.a.Component);$t.propTypes={getNextPage:y.a.func.isRequired,getPreviousPage:y.a.func.isRequired,previous:y.a.string,next:y.a.string};var _t=Object(V.default)(U.Flex,{target:"e1g4anlq0"})("justify-content:flex-end;"),en=n(34),tn=n.n(en),nn=n(76),an=n(58),rn=function(e){function t(){var e,n;l()(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=c()(this,(e=p()(t)).call.apply(e,[this].concat(r)))).getMenuItem=function(e){return m.a.createElement(an.default,{key:e.id,onSelect:n.props.handleChange,eventKey:e.id,isActive:e.id===n.props.visualization},e.name)},n.getButtonItems=function(e){var t=e.id===n.props.visualization;return m.a.createElement("li",{key:e.id,className:tn()({active:t})},m.a.createElement("a",{onClick:function(){return n.props.handleChange(e.id)}},e.name))},n.getDownloadCsvButton=function(){var e=n.props.handleCsvDownload;return m.a.createElement(ie,{onClick:e,icon:"icon-download",size:"xsmall"},Object(x.t)("Export CSV"))},n}return v()(t,e),o()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.options,a=t.visualization,r=n.find(function(e){return e.id===a}).name,i=Object(x.t)("View: ".concat(r));return m.a.createElement(ne,null,m.a.createElement(ae,null,n.map(function(t){return e.getButtonItems(t)})),m.a.createElement(re,null,m.a.createElement(nn.default,{title:i,className:"btn btn-default btn-sm"},n.map(function(t){return e.getMenuItem(t)}))),this.getDownloadCsvButton())}}]),t}(m.a.Component);rn.propTypes={options:y.a.arrayOf(y.a.shape({id:y.a.string,name:y.a.string})).isRequired,handleChange:y.a.func.isRequired,handleCsvDownload:y.a.func.isRequired,visualization:y.a.string.isRequired};var ln=rn,un=function(e){function t(e){var n;return l()(this,t),(n=c()(this,p()(t).call(this,e))).setDimensions=function(e){n.container=e,e&&null===n.state.height&&n.updateDimensions()},n.updateDimensions=function(){n.container&&n.setState({height:n.container.clientHeight,width:n.container.clientWidth})},n.throttledUpdateDimensions=St()(n.updateDimensions,200,{trailing:!0}),n.handleToggleVisualizations=function(e){var t=n.props.location;n.setState({view:e});var a=Object(Ve.h)(Object(Ve.g)(t.search),{visualization:e});b.browserHistory.push({pathname:t.pathname,search:a})},n.state={view:Object(Dt.h)(e.data,e.location.query.visualization),height:null,width:null},n}return v()(t,e),o()(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.throttledUpdateDimensions)}},{key:"componentWillReceiveProps",value:function(e){var t=e.data,n=e.location,a=Object(Dt.h)(t,n.query.visualization);if(Object(Ve.k)(this.props.location.search,e.location.search)){var r=Object(Ve.h)(Object(Ve.g)(n.search),{visualization:a});this.setState({view:a}),b.browserHistory.replace({pathname:n.pathname,search:r})}}},{key:"shouldComponentUpdate",value:function(e,t){return"fetching"===e.location.state&&e.location.state!==this.props.location.state||!et()(e,this.props)||!et()(t,this.state)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.throttledUpdateDimensions)}},{key:"renderToggle",value:function(){var e=this.props.data,t=e.baseQuery,n=e.byDayQuery,a=[{id:"table",name:Object(x.t)("Table")}];t.query.aggregations.length&&a.push({id:"line",name:Object(x.t)("Line")},{id:"bar",name:Object(x.t)("Bar")}),n.data&&a.push({id:"line-by-day",name:Object(x.t)("Line by Day")},{id:"bar-by-day",name:Object(x.t)("Bar by Day")});return m.a.createElement("div",null,m.a.createElement(ln,{options:a,handleChange:this.handleToggleVisualizations,handleCsvDownload:function(){return Object(Dt.a)(t.data)},visualization:this.state.view}))}},{key:"renderSummary",value:function(){var e=this.props.data,t=e.baseQuery,n=e.byDayQuery,a=["table","line","bar"].includes(this.state.view)?t.data:n.data,r=["query time: ".concat(Object(it.a)({value:a.timing.duration_ms,fixed:"10"})," ms")];return"table"===this.state.view&&r.push(Object(Dt.g)(t)),m.a.createElement(Qe,null,r.join(", "))}},{key:"renderNote",value:function(){return m.a.createElement(De,null,Object(x.t)("Displaying up to ".concat(Ke.i," results")))}},{key:"renderSavedQueryHeader",value:function(){return m.a.createElement(m.a.Fragment,null,m.a.createElement(T.a,null,Object(it.a)({value:this.props.savedQuery.name,fixed:"saved query"})),m.a.createElement(Fe,{onClick:this.props.onToggleEdit},m.a.createElement(Z.default,{src:"icon-edit"})))}},{key:"renderQueryResultHeader",value:function(){return m.a.createElement(T.a,null,Object(x.t)("Result"))}},{key:"render",value:function(){var e=this.props,t=e.data,n=t.baseQuery,a=t.byDayQuery,r=e.savedQuery,i=e.onFetchPage,l=e.utc,u=this.state.view,o=Object(Dt.b)(n.data.data,n.query),s=a.data&&Object(Dt.c)(a.data.data,a.query),c=s?{data:s.map(function(e){return e.seriesName}),truncate:80}:null,d={filter:function(e){return null!==e},truncate:80};return m.a.createElement(Se,{"data-test-id":"result"},m.a.createElement("div",null,m.a.createElement(be,null,r?this.renderSavedQueryHeader():this.renderQueryResultHeader()),this.renderToggle()),m.a.createElement(Ce,{innerRef:this.setDimensions},"table"===u&&m.a.createElement(Yt,{data:n.data,query:n.query,height:this.state.height,width:this.state.width}),"line"===u&&m.a.createElement(ze,null,m.a.createElement(zt.a,{series:o,height:300,tooltip:d,legend:{data:[n.query.aggregations[0][2]],truncate:80},xAxis:{truncate:80},renderer:"canvas"})),"bar"===u&&m.a.createElement(ze,null,m.a.createElement(Ct.a,{series:o,height:300,tooltip:d,legend:{data:[n.query.aggregations[0][2]],truncate:80},xAxis:{truncate:80},renderer:"canvas"})),"line-by-day"===u&&m.a.createElement(ze,null,m.a.createElement(zt.a,{series:s,height:300,tooltip:d,legend:c,renderer:"canvas",isGroupedByDate:!0,utc:l}),this.renderNote()),"bar-by-day"===u&&m.a.createElement(ze,null,m.a.createElement(Ct.a,{series:s,stacked:!0,height:300,tooltip:d,legend:c,renderer:"canvas",isGroupedByDate:!0,utc:l}),this.renderNote()),m.a.createElement(Re,null,this.renderSummary(),!n.query.aggregations.length&&m.a.createElement($t,{previous:n.previous,next:n.next,getNextPage:function(){return i("next")},getPreviousPage:function(){return i("previous")}}))))}}]),t}(m.a.Component);un.propTypes={data:y.a.object.isRequired,location:y.a.object.isRequired,savedQuery:R.default.DiscoverSavedQuery,onFetchPage:y.a.func.isRequired,onToggleEdit:y.a.func,utc:y.a.bool};var on=un,sn=n(33),cn=function(e){function t(){return l()(this,t),c()(this,p()(t).apply(this,arguments))}return v()(t,e),o()(t,[{key:"render",value:function(){return m.a.createElement(dn,null,m.a.createElement(me,null,m.a.createElement(sn.default,null)))}}]),t}(m.a.Component),dn=Object(V.default)("div",{target:"eepoz620"})("position:absolute;left:0;right:0;top:0;bottom:0;background-color:rgba(250,249,251,0.7);"),pn=function(e){function t(e){var n;return l()(this,t),(n=c()(this,p()(t).call(this,e))).state={isLoading:!0,data:[],topSavedQuery:e.savedQuery},n}return v()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.fetchAll()}},{key:"componentWillReceiveProps",value:function(e){if(e.savedQuery||this.props.savedQuery===e.savedQuery||this.fetchAll(),e.savedQuery&&e.savedQuery!==this.props.savedQuery){var t=this.state.data.map(function(t){return t.id===e.savedQuery.id?e.savedQuery:t});this.setState({data:t})}!e.savedQuery||this.state.topSavedQuery&&e.savedQuery.id!==this.state.topSavedQuery.id||this.setState({topSavedQuery:e.savedQuery})}},{key:"fetchAll",value:function(){var e=this;Object(Ve.c)(this.props.organization).then(function(t){e.setState({isLoading:!1,data:t})}).catch(function(){e.setState({isLoading:!1})})}},{key:"renderLoading",value:function(){return m.a.createElement(Oe,null,m.a.createElement(U.Flex,{justify:"center"},m.a.createElement(sn.default,{mini:!0})))}},{key:"renderEmpty",value:function(){return m.a.createElement(Oe,null,Object(x.t)("No saved queries"))}},{key:"renderListItem",value:function(e){var t=this.props.savedQuery,n=e.id,a=e.name,r=e.dateUpdated,i=this.props.organization;return m.a.createElement(Be,{key:n,isActive:t&&t.id===n},m.a.createElement(Ne,{to:"/organizations/".concat(i.slug,"/discover/saved/").concat(n,"/")},Object(it.a)({value:a,fixed:"saved query"}),m.a.createElement(Ie,null,Object(x.tct)("Updated [date] (UTC)",{date:Object(it.a)({value:D.a.utc(r).format("MMM DD HH:mm:ss"),fixed:"update-date"})}))))}},{key:"renderList",value:function(){var e=this,t=this.state,n=t.data,a=t.topSavedQuery,r=a?a.id:null;return n.length?n.map(function(t){return t.id!==r?e.renderListItem(t):null}):this.renderEmpty()}},{key:"render",value:function(){var e=this.state,t=e.topSavedQuery,n=e.isLoading;return m.a.createElement(Te,null,t&&this.renderListItem(t),n?this.renderLoading():this.renderList())}}]),t}(m.a.Component);pn.propTypes={organization:R.default.Organization.isRequired,savedQuery:R.default.DiscoverSavedQuery};var fn=n(242);var vn=function(e){function t(e){var n;l()(this,t),(n=c()(this,p()(t).call(this,e))).updateProjects=function(e){n.updateField("projects",e),Object(w.e)(e)},n.getDateTimeFields=function(e){var t=e.period,n=e.start,a=e.end;return{range:t||null,utc:e.utc,start:n&&Object(j.i)(n)||null,end:a&&Object(j.i)(a)||null}},n.changeTime=function(e){n.updateFields(n.getDateTimeFields(e))},n.updateDateTime=function(e){var t=n.getDateTimeFields(e),a=t.start,r=t.end,i=t.range,l=t.utc;n.updateFields({start:a,end:r,range:i,utc:l})},n.updateDateTimeAndRun=function(e){n.updateDateTime(e),n.runQuery()},n.updateField=function(e,t){n.props.queryBuilder.updateField(e,t),n.forceUpdate()},n.updateFields=function(e){Object.entries(e).forEach(function(e){var t=C()(e,2),a=t[0],r=t[1];n.updateField(a,r)})},n.updateAndRunQuery=function(e){n.updateFields(e),n.runQuery()},n.runQuery=function(){var e=n.props,t=e.queryBuilder,a=e.organization,i=e.location,l=n.state.resultManager;!function(e,t){var n={org_id:parseInt(e.id,10),projects:t.projects,fields:t.fields,aggregations:t.aggregations,orderby:t.orderby};"number"==typeof t.limit&&(n.limit=t.limit),n.conditions=t.conditions.map(function(e){return[e[0],e[1],"string"==typeof e[2]?"[REDACTED]":e[2]]}),Object($e.b)("discover.query",n)}(a,t.getExternal());var u=t.getInternal(),o=u.conditions,s=u.aggregations,c=o.filter(function(e){return Ye(e,t.getColumns())}),d=s.filter(function(e){return Object(Pe.c)(e,t.getColumns())});c.length!==o.length&&n.updateField("conditions",c),d.length!==s.length&&n.updateField("aggregations",d),n.setState({isFetchingQuery:!0}),l.fetchAll().then(function(e){!n.props.params.savedQueryId&&b.browserHistory.push({pathname:"/organizations/".concat(a.slug,"/discover/"),state:"fetching",search:Object(Ve.h)(t.getInternal(),r()({},i.query.visualization&&{visualization:i.query.visualization}))}),n.setState({data:e,isFetchingQuery:!1})}).catch(function(e){var t=e&&e.message||Object(x.t)("An error occurred");Object(F.addErrorMessage)(t),n.setState({isFetchingQuery:!1})})},n.onFetchPage=function(e){return n.setState({isFetchingQuery:!0}),n.state.resultManager.fetchPage(e).then(function(e){n.setState({data:e,isFetchingQuery:!1})}).catch(function(e){var t=e&&e.message||Object(x.t)("An error occurred");Object(F.addErrorMessage)(t),n.setState({isFetchingQuery:!1})})},n.toggleSidebar=function(e){e!==n.state.view&&(n.setState({view:e}),b.browserHistory.replace({pathname:"/organizations/".concat(n.props.organization.slug,"/discover/"),query:r()({},n.props.location.query,{view:e})}))},n.loadSavedQueries=function(){b.browserHistory.push({pathname:"/organizations/".concat(n.props.organization.slug,"/discover/"),query:{view:"saved"}})},n.reset=function(){var e=n.props,t=e.savedQuery,a=e.queryBuilder,r=e.organization;t?(a.reset(t),n.setState({isEditingSavedQuery:!1})):b.browserHistory.push({pathname:"/organizations/".concat(r.slug,"/discover/")})},n.deleteSavedQuery=function(){var e=n.props,t=e.organization,a=e.savedQuery,r=n.state.resultManager;Object(Ve.b)(t,a.id).then(function(){Object(F.addSuccessMessage)(Object(x.tct)("Successfully deleted query [name]",{name:a.name})),r.reset(),n.loadSavedQueries()}).catch(function(){Object(F.addErrorMessage)(Object(x.t)("Could not delete query")),n.setState({isFetchingQuery:!1})})},n.updateSavedQuery=function(e){var t=n.props,a=t.queryBuilder,i=t.savedQuery,l=t.organization,u=t.toggleEditMode,o=a.getInternal(),s=r()({},o,{name:e});Object(Ve.l)(l,i.id,s).then(function(e){Object(F.addSuccessMessage)(Object(x.t)("Updated query")),u(),n.props.updateSavedQueryData(e)}).catch(function(){Object(F.addErrorMessage)(Object(x.t)("Could not update query"))})};var a=function(e){var t={baseQuery:{query:null,data:null,next:null,previous:null,current:null},byDayQuery:{query:null,data:null}};return{getAll:function(){return t},fetchAll:function(){var a=e.getExternal(),r=e.getQueryByType(a,"baseQuery"),i=e.getQueryByType(a,"byDayQuery"),l=[e.fetch(r)],u=a.aggregations.length>0;return u&&l.push(e.fetch(i)),Promise.all(l).then(function(e){return t.baseQuery.query=a,t.baseQuery.data=e[0],t.baseQuery.current="0:0:1",n(e[0].pageLinks),u?(t.byDayQuery.query=i,t.byDayQuery.data=e[1]):(t.byDayQuery.query=null,t.byDayQuery.data=null),t})},reset:function(){t={baseQuery:{query:null,data:null,next:null,previous:null,current:null},byDayQuery:{query:null,data:null}}},shouldDisplayResult:function(){return null!==t.baseQuery.data},fetchPage:function(a){var r=e.getExternal(),i=e.getQueryByType(r,"baseQuery"),l=t.baseQuery[a];return l?e.fetch(i,l).then(function(e){return t.baseQuery.current=l,t.baseQuery.query=r,t.baseQuery.data=e,n(e.pageLinks),t}):Promise.reject(new Error("No New Page Available"))}};function n(e){if(e){var n=Object(fn.a)(e);t.baseQuery.next=n.next.results?n.next.cursor:null,t.baseQuery.previous=n.previous.results?n.previous.cursor:null}}}(e.queryBuilder);return n.state={resultManager:a,data:a.getAll(),isFetchingQuery:!1,isEditingSavedQuery:e.isEditingSavedQuery,savedQueryName:null,view:e.view||"query"},n}return v()(t,e),o()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.queryBuilder,n=e.location.search,a=e.savedQuery,r=e.isEditingSavedQuery,i=e.params,l=e.isLoading,u=this.state.resultManager;if(l!==this.props.isLoading&&(a||n))this.runQuery();else if(a&&a!==this.props.savedQuery&&(this.setState({view:"saved"}),this.runQuery()),r===this.props.isEditingSavedQuery){if(Object(Ve.k)(this.props.location.search,e.location.search)){var o=Object(Ve.g)(n);if(n||i.savedQueryId){if(n){var s=o.projects,c=o.range,d=o.start,p=o.end,f=o.utc,v=!1;s&&(this.updateProjects(s),v=!0),(c||p&&d)&&(this.updateDateTime({period:c||null,start:d||null,end:p||null,utc:void 0!==f?f:null}),Object(w.a)({start:d&&new Date(D.a.utc(d).local()),end:p&&new Date(D.a.utc(p).local()),period:c,utc:f}),v=!0),v&&this.runQuery()}}else t.reset(o),u.reset(),this.setState({data:u.getAll()})}}else this.setState({isEditingSavedQuery:r})}},{key:"renderSidebarNav",value:function(){var e=this,t=this.state.view,n=[{id:"query",title:Object(x.t)("New query")},{id:"saved",title:Object(x.t)("Saved queries")}];return m.a.createElement(m.a.Fragment,null,m.a.createElement(ge,{underlined:!0},n.map(function(n){var a=n.id,r=n.title;return m.a.createElement("li",{key:a,className:t===a?"active":""},m.a.createElement("a",{onClick:function(){return e.toggleSidebar(a)}},r))})))}},{key:"render",value:function(){var e=this.state,t=e.data,n=e.isFetchingQuery,a=e.view,r=e.resultManager,i=e.isEditingSavedQuery,l=this.props,u=l.queryBuilder,o=l.organization,s=l.savedQuery,c=l.toggleEditMode,d=l.isLoading,p=l.location,f=l.utc,v=u.getInternal(),h=r.shouldDisplayResult(),g=v.start&&D()(v.start).local().toDate()||v.start,y=v.end&&D()(v.end).local().toDate()||v.end;return m.a.createElement(ee,null,m.a.createElement(le,null,this.renderSidebarNav(),"saved"===a&&m.a.createElement(Le,null,m.a.createElement(pn,{organization:o,savedQuery:s})),"query"===a&&m.a.createElement(kt,{organization:o,queryBuilder:u,isFetchingQuery:n||d,onUpdateField:this.updateField,onRunQuery:this.runQuery,onReset:this.reset,isLoading:d}),i&&s&&m.a.createElement(Qt,{title:Object(x.t)("Edit Query"),onClose:c},m.a.createElement(bt,{savedQuery:s,queryBuilder:u,isFetchingQuery:n,onUpdateField:this.updateField,onRunQuery:this.runQuery,onReset:this.reset,onDeleteQuery:this.deleteSavedQuery,onSaveQuery:this.updateSavedQuery,isLoading:d}))),m.a.createElement(te,{organization:o,projects:v.projects,hasCustomRouting:!0,relative:v.range,start:g,end:y,utc:f,showEnvironmentSelector:!1,onChangeProjects:this.updateProjects,onUpdateProjects:this.runQuery,onChangeTime:this.changeTime,onUpdateTime:this.updateDateTimeAndRun}),m.a.createElement(ve,null,m.a.createElement(he,null,h&&m.a.createElement(on,{location:p,utc:f,data:t,savedQuery:s,onToggleEdit:c,onFetchPage:this.onFetchPage}),!h&&m.a.createElement(m.a.Fragment,null,m.a.createElement("div",null,m.a.createElement(be,null,m.a.createElement(T.a,null,Object(x.t)("Discover")," ",m.a.createElement(L.a,null)))),m.a.createElement(Ot,{updateQuery:this.updateAndRunQuery})),n&&m.a.createElement(cn,null))))}}]),t}(m.a.Component);vn.propTypes={organization:R.default.Organization.isRequired,location:y.a.object.isRequired,queryBuilder:y.a.object.isRequired,savedQuery:R.default.DiscoverSavedQuery,isEditingSavedQuery:y.a.bool,updateSavedQueryData:y.a.func.isRequired,view:y.a.oneOf(["query","saved"]),toggleEditMode:y.a.func.isRequired,isLoading:y.a.bool.isRequired,utc:y.a.bool},vn.defaultProps={utc:!0};var hn=n(1868);n.d(t,"OrganizationDiscoverContainer",function(){return mn});var mn=function(e){function t(e,n){var a;l()(this,t),(a=c()(this,p()(t).call(this,e,n))).loadTags=function(){return a.queryBuilder.load()},a.setLoadedState=function(){a.setState({isLoading:!1})},a.fetchSavedQuery=function(e){var t=a.context.organization;return Object(Ve.d)(t,e).then(function(e){a.queryBuilder?a.queryBuilder.reset(Object(Ve.j)(e)):a.queryBuilder=Object(hn.a)(Object(Ve.j)(e),t),a.setState({isLoading:!1,savedQuery:e,view:"saved"})}).catch(function(){b.browserHistory.push({pathname:"/organizations/".concat(t.slug,"/discover/"),query:{view:"saved"}}),window.location.reload()})},a.updateSavedQuery=function(e){a.setState({savedQuery:e})},a.toggleEditMode=function(){var e=a.context.organization,t=a.state.savedQuery,n="true"===a.props.location.query.editing,i=r()({},a.props.location.query);n?delete i.editing:i.editing="true",b.browserHistory.push({pathname:"/organizations/".concat(e.slug,"/discover/saved/").concat(t.id,"/"),query:i})},a.state={isLoading:!0,savedQuery:null,view:Object(Ve.i)(e.params,e.location.query.view)};var i=e.location.search,u=n.organization,o=Object(Ve.g)(i);if(o.hasOwnProperty("projects")?Object(w.e)(o.projects):o.projects=e.selection.projects,["range","start","end"].some(function(e){return o.hasOwnProperty(e)})){var s=Object(j.h)();Object(w.a)({start:o.start&&Object(j.j)(o.start)||null,end:o.end&&Object(j.j)(o.end)||null,period:o.range||null,utc:o.utc||"UTC"===s})}else o.start=e.selection.datetime.start,o.end=e.selection.datetime.end,o.range=e.selection.datetime.period,o.utc=e.selection.datetime.utc;return a.queryBuilder=Object(hn.a)(o,u),a}return v()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;document.body.classList.add("body-discover");var t=this.props.params.savedQueryId;t?this.loadTags().then(function(){return e.fetchSavedQuery(t)}).then(this.setLoadedState):this.loadTags().then(this.setLoadedState)}},{key:"componentWillReceiveProps",value:function(e){if(e.params.savedQueryId)e.params.savedQueryId!==this.props.params.savedQueryId&&this.fetchSavedQuery(e.params.savedQueryId),e.location.query.view!==this.props.location.query.view&&this.setState({view:Object(Ve.i)(e.params,e.location.query.view)});else if(this.setState({savedQuery:null}),this.props.params.savedQueryId){var t=e.selection.projects;this.queryBuilder.reset({projects:t})}}},{key:"componentWillUnmount",value:function(){this.queryBuilder.cancelRequests(),document.body.classList.remove("body-discover")}},{key:"renderNoAccess",value:function(){return m.a.createElement(Q.default,{type:"warning"},Object(x.t)("You don't have access to this feature"))}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.savedQuery,a=e.view,r=this.props,i=r.location,l=r.params,u=r.selection,o=this.context.organization;return m.a.createElement(E.a,{title:"Discover - ".concat(o.slug," - Sentry")},m.a.createElement(k.a,{features:["organizations:discover"],hookName:"discover-page",organization:o,renderDisabled:this.renderNoAccess},m.a.createElement(_,null,m.a.createElement(vn,{utc:u.datetime.utc,isLoading:t,organization:o,queryBuilder:this.queryBuilder,location:i,params:l,savedQuery:n,isEditingSavedQuery:"true"===this.props.location.query.editing,updateSavedQueryData:this.updateSavedQuery,view:a,toggleEditMode:this.toggleEditMode}))))}}]),t}(m.a.Component);mn.contextTypes={organization:R.default.Organization},mn.propTypes={selection:y.a.object.isRequired};t.default=Object(q.a)(mn)}}]);
//# sourceMappingURL=OrganizationDiscover.js.map